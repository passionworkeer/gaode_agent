# 🚀 快速开始指南

## 📦 环境准备

### 1. 系统要求
- Python: 3.9 - 3.12
- 操作系统: Windows / macOS / Linux
- 内存: 建议8GB以上

### 2. 安装依赖

```bash
# 克隆或下载项目到本地
cd gaode_agent

# 创建虚拟环境(推荐)
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 如果安装慢,使用清华镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
```

### 3. 配置API密钥

创建`.env`文件(项目根目录):

```env
# 通义千问API密钥(必须)
DASHSCOPE_API_KEY=sk-your-dashscope-api-key

# Tavily搜索API密钥(必须)
TAVILY_API_KEY=tvly-your-tavily-api-key

# 高德地图API密钥(必须)
GAODE_API_KEY=your-gaode-api-key

# 可选配置
LOG_LEVEL=INFO
MEMORY_DIR=./memory
```

**获取API密钥**:
- 通义千问: https://dashscope.console.aliyun.com/
- Tavily搜索: https://tavily.com/
- 高德地图: https://lbs.amap.com/

---

## 🎯 启动系统

### 方式一: 标准启动

```bash
# 确保在项目根目录
cd gaode_agent

# 启动Gradio界面
python main_gradio.py
```

启动成功后会看到:
```
Running on local URL:  http://127.0.0.1:7860
Running on public URL: https://xxxxx.gradio.live (可选)
```

打开浏览器访问: http://127.0.0.1:7860

### 方式二: 后台启动(Linux/macOS)

```bash
nohup python main_gradio.py > agent.log 2>&1 &
```

### 方式三: IDE运行

在PyCharm/VSCode中打开`main_gradio.py`,直接运行

---

## 💡 功能使用

### 1. 基础对话

在输入框输入问题,点击"发送"或按回车:

```
示例:
- 你好,介绍一下你自己
- 2025年云南旅游有哪些推荐景点?
- 从深圳去广州怎么走最快?
```

### 2. 深度思考模式

**使用场景**: 复杂问题、行程规划、决策分析

**操作步骤**:
1. 勾选"🧠 启用深度思考模式"
2. 输入复杂问题
3. 系统会展示思考过程
4. 给出详细解答

```
示例问题:
- 帮我规划一个北京到杭州的三日游,预算5000元
- 分析一下从深圳去厦门是坐高铁好还是飞机好
- 推荐适合老人和小孩的广州周边两日游路线
```

### 3. 地图与路线

系统会自动调用高德地图工具:

```
示例:
- 深圳技术大学周边1000米内的餐厅
- 从深圳北站到广州南站的驾车路线
- 杭州西湖的详细地址和经纬度
```

返回结果包含:
- 文字描述
- 可视化地图(HTML)
- 距离、时间等关键信息

### 4. 数据可视化

系统支持生成图表:

```
示例:
- 对比北京、上海、深圳的房价趋势(需要提供数据)
- 生成我的旅行支出饼图
```

### 5. 清空对话

点击"清空"按钮会:
- 删除当前会话的短期记忆
- 保留历史成功案例
- 重置对话界面

---

## 🔍 进阶功能

### 查看成功案例库

```python
from chat_agent_qwen.agent_memory.memory import MemoryManager

# 创建记忆管理器
memory = MemoryManager()

# 查看某用户的成功案例
user_id = "user_abc123"
cases = memory.load_success_cases(user_id, limit=10)

for i, case in enumerate(cases, 1):
    print(f"\n案例 {i}:")
    print(f"问题: {case['query']}")
    print(f"结果: {case['result'][:100]}...")
    print(f"使用工具: {case.get('tools_used', [])}")
    print(f"时间: {case['timestamp']}")
```

### 自定义Prompt

编辑`chat_agent_qwen/prompts/system_prompts.py`:

```python
# 示例:修改对话风格
CHAT_RESPONSE_SYSTEM_PROMPT = """你是一个幽默风趣的旅行助手...
"""

# 修改后重启系统即可生效
```

### 添加ICL示例

在`system_prompts.py`中添加新示例:

```python
ICL_FEW_SHOT_EXAMPLES = [
    {
        "input": "你的问题示例",
        "output": "期望的回答示例"
    },
    # ... 更多示例
]
```

---

## 🐛 常见问题

### Q1: 启动报错 "No module named xxx"

**解决方案**:
```bash
# 确认虚拟环境已激活
pip list  # 查看已安装的包

# 重新安装依赖
pip install -r requirements.txt --force-reinstall
```

### Q2: API调用失败

**检查清单**:
1. `.env`文件是否在项目根目录
2. API密钥是否正确填写
3. 网络连接是否正常
4. API额度是否用完

```bash
# 测试API连接
python -c "from dotenv import load_dotenv; import os; load_dotenv(); print(os.getenv('DASHSCOPE_API_KEY'))"
```

### Q3: 地图无法显示

**解决方案**:
1. 检查`temp_visualizations`目录是否存在
2. 查看浏览器控制台是否有CORS错误
3. 确认高德API密钥有效

### Q4: 深度思考模式无效

**检查**:
- 确认已勾选"🧠 启用深度思考模式"
- 查看日志是否有模型切换信息
- 重启Gradio服务

### Q5: 内存占用过高

**优化建议**:
```python
# 在 MemoryManager.__init__ 中调整
max_history_length = 50  # 减少历史记录长度
max_success_cases = 50   # 减少成功案例数量
```

---

## 📊 性能优化

### 1. 使用GPU加速(可选)

```bash
# 卸载CPU版faiss
pip uninstall faiss-cpu

# 安装GPU版
pip install faiss-gpu
```

### 2. 启用缓存

编辑`.env`:
```env
ENABLE_CACHE=true
CACHE_DIR=./cache
```

### 3. 调整并发数

在`main_gradio.py`中:
```python
demo.launch(
    max_threads=10,  # 调整线程数
    show_error=True
)
```

---

## 🔒 安全建议

1. **不要提交`.env`到Git**
   - 已添加到`.gitignore`
   - API密钥保密

2. **定期更换API密钥**
   - 建议每3个月更换一次

3. **限制对外访问**
   ```python
   demo.launch(
       server_name="127.0.0.1",  # 仅本地访问
       share=False               # 不生成公共链接
   )
   ```

---

## 📝 日志查看

### 实时查看日志

```bash
# Linux/macOS
tail -f agent.log

# Windows PowerShell
Get-Content agent.log -Wait
```

### 日志级别调整

在代码中设置:
```python
import logging
logging.basicConfig(level=logging.DEBUG)  # 详细日志
logging.basicConfig(level=logging.INFO)   # 标准日志
logging.basicConfig(level=logging.WARNING) # 仅警告
```

---

## 🎓 学习资源

- **LangChain文档**: https://python.langchain.com/
- **Gradio文档**: https://www.gradio.app/docs/
- **通义千问文档**: https://help.aliyun.com/zh/dashscope/
- **高德地图API**: https://lbs.amap.com/api/

---

## 💪 下一步

恭喜您完成快速开始!

接下来可以:
1. 🧪 体验各种功能,熟悉系统
2. 📖 阅读`改进完成报告.md`了解技术细节
3. 🔧 根据需求自定义Prompt和配置
4. 📊 查看成功案例库,分析使用模式
5. 🚀 探索进阶功能,打造专属AI助手

祝使用愉快! 🎉
